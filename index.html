let lessonCount = 0;
let totalHours = 0;

// Load existing data from Local Storage on page load
window.onload = function() {
    const storedLessons = JSON.parse(localStorage.getItem('lessons'));
    const storedTotalHours = parseFloat(localStorage.getItem('totalHours'));

    if (storedLessons) {
        storedLessons.forEach(lesson => addLessonToDOM(lesson));
        lessonCount = storedLessons.length;
    }

    if (!isNaN(storedTotalHours)) {
        totalHours = storedTotalHours;
        document.getElementById('total-hours').innerText = totalHours;
    }
};

function addLesson() {
    const lessonContent = document.getElementById('lesson-content').value;
    const homework = document.getElementById('homework').value;
    const lessonHours = parseFloat(document.getElementById('lesson-hours').value);

    if (!lessonContent || isNaN(lessonHours)) {
        alert('Please fill out the lesson content and hours.');
        return;
    }

    const lesson = {
        content: lessonContent,
        homework: homework,
        hours: lessonHours
    };

    lessonCount++;
    totalHours += lessonHours;

    // Add the lesson to Local Storage
    let lessons = JSON.parse(localStorage.getItem('lessons')) || [];
    lessons.push(lesson);
    localStorage.setItem('lessons', JSON.stringify(lessons));
    localStorage.setItem('totalHours', totalHours.toString());

    addLessonToDOM(lesson);

    // Clear input fields
    document.getElementById('lesson-content').value = '';
    document.getElementById('homework').value = '';
    document.getElementById('lesson-hours').value = '';
}

function addLessonToDOM(lesson) {
    const lessonDiv = document.createElement('div');
    lessonDiv.className = 'lesson';
    lessonDiv.innerHTML = `<strong>Lesson ${lessonCount}:</strong><br>
                           <strong>Content:</strong> ${lesson.content}<br>
                           <strong>Homework:</strong> ${lesson.homework}<br>
                           <strong>Hours:</strong> ${lesson.hours}`;

    document.getElementById('lessons-container').appendChild(lessonDiv);
    document.getElementById('total-hours').innerText = totalHours;
}

function resetMonth() {
    const monthName = document.getElementById('month-name').value;
    if (!monthName) {
        alert('Please enter the month name.');
        return;
    }

    alert(`Month: ${monthName}\nTotal Hours: ${totalHours}\nLessons: ${lessonCount}`);

    // Clear Local Storage and reset the display
    localStorage.removeItem('lessons');
    localStorage.removeItem('totalHours');

    lessonCount = 0;
    totalHours = 0;
    document.getElementById('lessons-container').innerHTML = '';
    document.getElementById('total-hours').innerText = totalHours;
    document.getElementById('month-name').value = '';
}

function addProposal() {
    const proposalDatetime = document.getElementById('next-class-datetime').value;

    if (!proposalDatetime) {
        alert('Please select a date and time for the next class.');
        return;
    }

    const lessonDiv = document.createElement('div');
    lessonDiv.className = 'lesson';
    lessonDiv.innerHTML = `<strong>Teacher's Proposal for Next Class:</strong><br>
                           <strong>Proposed Date and Time:</strong> ${new Date(proposalDatetime).toLocaleString()}<br>
                           <div class="proposal-response">
                               <label class="response-option"><input type="radio" name="response" value="accept"> Accept</label>
                               <label class="response-option"><input type="radio" name="response" value="propose-alternative"> Propose Alternative Time</label>
                               <textarea id="alternative-time" placeholder="If proposing an alternative, enter the preferred date and time here..."></textarea>
                               <button onclick="acceptProposal()">Notify Teacher of Acceptance</button>
                           </div>`;

    document.getElementById('lessons-container').appendChild(lessonDiv);
    document.getElementById('next-class-datetime').value = '';
}

function acceptProposal() {
    const response = document.querySelector('input[name="response"]:checked').value;
    if (response === 'accept') {
        alert('The teacher has been notified of your acceptance.');
        // You could store this acceptance in Local Storage or update the UI accordingly
        localStorage.setItem('nextClassAccepted', true);
    } else {
        const alternativeTime = document.getElementById('alternative-time').value;
        alert(`You have proposed an alternative time: ${alternativeTime}`);
        // You could store this alternative proposal in Local Storage or update the UI accordingly
        localStorage.setItem('nextClassAlternative', alternativeTime);
    }
}
